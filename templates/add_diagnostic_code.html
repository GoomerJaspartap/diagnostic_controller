{% extends 'base.html' %}
{% block title %}Add Diagnostic Code - Diagnostic Controller{% endblock %}
{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10 col-12">
        <div class="card shadow p-4">
            <h3 class="mb-3" style="color: #003366;">Add Diagnostic Code</h3>
            {% with messages = get_flashed_messages(with_categories=true) %}
              {% if messages %}
                {% for category, message in messages %}
                  <div class="alert alert-{{ category }}">{{ message }}</div>
                {% endfor %}
              {% endif %}
            {% endwith %}
            <form method="POST">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label for="code" class="form-label">Code</label>
                        <input type="text" class="form-control" id="code" name="code" required>
                    </div>
                    <div class="col-md-6">
                        <label for="description" class="form-label">Description</label>
                        <input type="text" class="form-control" id="description" name="description" required>
                    </div>
                    <div class="col-md-6">
                        <label for="type" class="form-label">Type</label>
                        <select class="form-select" id="type" name="type" required>
                            <option value="Temperature" {% if request.args.get('type') == 'Temperature' %}selected{% endif %}>Temperature</option>
                            <option value="Humidity" {% if request.args.get('type') == 'Humidity' %}selected{% endif %}>Humidity</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_ip" class="form-label">Modbus IP Address</label>
                        <input type="text" class="form-control" id="modbus_ip" name="modbus_ip" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_port" class="form-label">Modbus Port</label>
                        <input type="number" class="form-control" id="modbus_port" name="modbus_port" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_unit_id" class="form-label">Modbus Unit ID</label>
                        <input type="number" class="form-control" id="modbus_unit_id" name="modbus_unit_id" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_register_type" class="form-label">Register Type</label>
                        <select class="form-select" id="modbus_register_type" name="modbus_register_type" required>
                            <option value="Coil">Coil</option>
                            <option value="Discrete Input">Discrete Input</option>
                            <option value="Holding Register">Holding Register</option>
                            <option value="Input Register">Input Register</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_register_address" class="form-label">Register Address</label>
                        <input type="number" class="form-control" id="modbus_register_address" name="modbus_register_address" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_data_type" class="form-label">Data Type</label>
                        <select class="form-select" id="modbus_data_type" name="modbus_data_type" required>
                            <option value="int16">Integer (16-bit)</option>
                            <option value="int32">Integer (32-bit)</option>
                            <option value="float32">Float (32-bit)</option>
                            <option value="boolean">Boolean</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_byte_order" class="form-label">Byte Order</label>
                        <select class="form-select" id="modbus_byte_order" name="modbus_byte_order" required>
                            <option value="big-endian">Big-endian</option>
                            <option value="little-endian">Little-endian</option>
                            <option value="word-swapped">Word-swapped (32-bit)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_scaling" class="form-label">Scaling</label>
                        <input type="text" class="form-control" id="modbus_scaling" name="modbus_scaling" placeholder="e.g., 0.01 for 24.5°C = 2450" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_units" class="form-label">Units</label>
                        <input type="text" class="form-control" id="modbus_units" name="modbus_units" placeholder="e.g., °C, Pa, m/s" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_offset" class="form-label">Offset</label>
                        <input type="text" class="form-control" id="modbus_offset" name="modbus_offset" placeholder="e.g., 0" required>
                    </div>
                    <div class="col-md-6">
                        <label for="modbus_function_code" class="form-label">Function Code</label>
                        <select class="form-select" id="modbus_function_code" name="modbus_function_code" required>
                            <option value="01">Read Coils (01)</option>
                            <option value="02">Read Discrete Inputs (02)</option>
                            <option value="03">Read Holding Registers (03)</option>
                            <option value="04">Read Input Registers (04)</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <label for="upper_limit">Upper Limit</label>
                        <input type="number" step="any" class="form-control" id="upper_limit" name="upper_limit" required>
                    </div>
                    <div class="col-md-6">
                        <label for="lower_limit">Lower Limit</label>
                        <input type="number" step="any" class="form-control" id="lower_limit" name="lower_limit" required>
                    </div>
                    <div class="col-md-6 d-flex align-items-end">
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enabled" name="enabled" checked>
                            <label class="form-check-label" for="enabled">Enabled</label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 mt-3" style="background-color: #003366; border-color: #003366;">Add Code</button>
            </form>
            <div class="mt-3 text-center">
                <a href="/diagnostic_codes" class="text-decoration-none" style="color: #003366;">&larr; Back to Diagnostic Codes</a>
            </div>
        </div>
    </div>
</div>
{% endblock %} 